# =============================================================================
# XTREME PROFILE - Modern high-performance build profile (2025/2026 best practices)
# =============================================================================
# Uses the Meta/Google/Cloudflare production stack:
# - Thin LTO (80% of fat LTO gains, 20% of build time)
# - Parallel codegen (codegen-units=2)
# - Symbols preserved for BOLT post-link optimization
# - BOLT-ready with --emit-relocs support
#
# Build: cargo build --profile xtreme
# Run:   ./target/xtreme/codex-cli
#
# For maximum performance, follow up with BOLT optimization:
#   See: codex-xtreme --dev for BOLT workflow
# =============================================================================

[meta]
name = "xtreme-profile"
description = "Modern high-performance profile (thin LTO, BOLT-ready)"
version_range = ">=0.88.0"
workspace_relative = true

[[patches]]
id = "add-xtreme-profile"
file = "Cargo.toml"

[patches.query]
type = "toml"
section = "profile.xtreme"

[patches.operation]
type = "append-section"
text = '''

# Injected by codex-patcher (xtreme-profile)
# Modern 2025/2026 stack: thin LTO + parallel codegen + BOLT-ready
[profile.xtreme]
inherits = "release"
lto = "thin"           # 80% of fat LTO gains, much faster builds
codegen-units = 2      # Parallel codegen, minimal perf loss
opt-level = 3
strip = "none"         # Keep symbols for BOLT/profiling
debug = 1              # Debug info for profiling (no runtime cost)
panic = "abort"
overflow-checks = false

[profile.xtreme.build-override]
opt-level = 3

[profile.xtreme.package."*"]
opt-level = 3
'''
